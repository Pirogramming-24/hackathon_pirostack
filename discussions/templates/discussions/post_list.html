{% extends 'base.html' %}

{% block title %}커뮤니티{% endblock %}

{% block content %}
<div class="flex">
    <!-- 사이드바 -->
    <aside class="w-64 flex-shrink-0 border-r border-gray-200 bg-white px-6 py-8 min-h-screen">
        <div class="sticky top-24">
            <!-- 새 글 작성 버튼 -->
            <a href="{% url 'discussions:post_create' %}" class="block w-full mb-6 px-4 py-2 bg-[#059212] text-white text-center rounded-lg hover:bg-[#06D001] transition-colors font-medium">
                + 새 글 작성
            </a>


            <!-- 질문 게시판 링크 -->
            <a href="{% if request.session.is_staff %}{% url 'questions:staff_unanswered' %}{% else %}{% url 'questions:list' %}{% endif %}" class="flex items-center gap-2 px-4 py-2 mb-4 rounded-md hover:bg-gray-50 transition-colors">
                <svg width="20" height="20" viewBox="0 0 198 198" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M140.25 165H33V57.75C33 53.2125 29.2875 49.5 24.75 49.5C20.2125 49.5 16.5 53.2125 16.5 57.75V165C16.5 174.075 23.925 181.5 33 181.5H140.25C144.788 181.5 148.5 177.788 148.5 173.25C148.5 168.712 144.788 165 140.25 165Z" fill="currentColor"/>
                    <path d="M165 16.5H66C56.925 16.5 49.5 23.925 49.5 33V132C49.5 141.075 56.925 148.5 66 148.5H165C174.075 148.5 181.5 141.075 181.5 132V33C181.5 23.925 174.075 16.5 165 16.5ZM115.583 123.75C110.715 123.75 106.92 119.872 106.92 115.087C106.92 110.22 110.798 106.507 115.583 106.507C120.45 106.507 124.163 110.22 124.163 115.087C124.08 119.872 120.45 123.75 115.583 123.75ZM136.208 72.8475C131.01 80.52 126.06 82.83 123.337 87.78C122.677 88.935 122.265 89.925 122.017 91.8225C121.605 95.04 119.047 97.4325 115.83 97.4325H115.583C111.953 97.4325 109.065 94.2975 109.395 90.6675C109.643 88.3575 110.138 85.965 111.458 83.7375C114.84 77.715 121.193 74.1675 124.905 68.8875C128.865 63.2775 126.638 52.8825 115.5 52.8825C110.467 52.8825 107.167 55.5225 105.105 58.6575C103.537 61.05 100.403 61.875 97.7625 60.72C94.2975 59.235 92.8125 54.945 94.9575 51.8925C99.165 45.7875 106.177 41.25 115.417 41.25C125.565 41.25 132.577 45.87 136.125 51.645C139.178 56.6775 140.91 65.9175 136.208 72.8475Z" fill="currentColor"/>
                </svg>
                <span>전체 질문</span>
            </a>

            <!-- 전체 보기 -->
            <a href="{% url 'discussions:post_list' %}" class="flex items-center gap-2 px-4 py-2 mb-2 rounded-md bg-gray-100 font-semibold transition-colors">
                <svg width="20" height="20" viewBox="0 0 195 195" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M43.3333 102.917V59.5833H27.0833C22.7736 59.5833 18.6403 61.2954 15.5928 64.3429C12.5454 67.3903 10.8333 71.5236 10.8333 75.8333V173.333C10.8414 174.339 11.1294 175.323 11.6652 176.175C12.201 177.026 12.9633 177.712 13.8667 178.154C14.737 178.55 15.6966 178.708 16.648 178.613C17.5994 178.518 18.5086 178.173 19.2833 177.613L47.1792 157.083H119.979C122.032 157.144 124.076 156.783 125.983 156.021C127.891 155.26 129.622 154.115 131.069 152.658C132.516 151.201 133.649 149.462 134.397 147.549C135.145 145.636 135.492 143.59 135.417 141.538V135.417H75.8333C67.2138 135.417 58.9473 131.993 52.8524 125.898C46.7574 119.803 43.3333 111.536 43.3333 102.917Z" fill="currentColor"/>
                    <path d="M167.917 21.6667H75.8333C71.5236 21.6667 67.3903 23.3787 64.3429 26.4262C61.2954 29.4736 59.5833 33.6069 59.5833 37.9167V102.917C59.5833 107.226 61.2954 111.36 64.3429 114.407C67.3903 117.455 71.5236 119.167 75.8333 119.167H149.229L175.121 139.262C175.891 139.832 176.797 140.187 177.749 140.291C178.7 140.396 179.663 140.246 180.538 139.858C181.459 139.419 182.238 138.729 182.784 137.866C183.331 137.004 183.622 136.004 183.625 134.983V37.9167C183.627 33.6991 181.99 29.6459 179.059 26.6135C176.127 23.5812 172.132 21.8072 167.917 21.6667Z" fill="currentColor"/>
                </svg>
                <span>커뮤니티</span>
            </a>

            <!-- 정렬 옵션 -->
            <div class="mb-4 pt-4 border-t border-gray-200">
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">정렬</p>
                <a href="?sort=latest" class="block px-4 py-1.5 text-sm rounded-md {% if sort == 'latest' %}bg-[#059212] text-white{% else %}text-gray-600 hover:bg-gray-50{% endif %} transition-colors">
                    최신순
                </a>
                <a href="?sort=oldest" class="block px-4 py-1.5 text-sm rounded-md {% if sort == 'oldest' %}bg-[#059212] text-white{% else %}text-gray-600 hover:bg-gray-50{% endif %} transition-colors">
                    오래된순
                </a>
            </div>
        </div>
    </aside>

    <!-- 메인 컨텐츠 -->
    <main class="flex-1 min-w-0 max-w-5xl mx-auto px-8 py-8">
        <div class="mb-6">
            <h1 class="text-3xl font-bold mb-2">커뮤니티</h1>
            <p class="text-gray-600">총 {{ posts.count }}개의 게시글</p>
        </div>

    {% if posts %}
        <div class="space-y-4">
            {% for post in posts %}
            <a href="{% url 'discussions:post_detail' post.id %}" class="block p-5 bg-white border border-gray-200 rounded-lg hover:border-gray-300 hover:shadow-md transition-all">
                <div class="flex items-start justify-between gap-4 mb-3">
                    <h3 class="text-lg font-semibold flex-1">
                        {{ post.title }}
                    </h3>
                </div>
                <p class="text-sm text-gray-600 mb-3 line-clamp-2">
                    {{ post.content|truncatechars:100 }}
                </p>
                <div class="flex items-center gap-4 text-sm text-gray-500">
                    <span class="font-medium">{{ post.author.username }}</span>
                    <span>·</span>
                    <span>{{ post.created_at|date:"Y.m.d H:i" }}</span>
                    <span>·</span>
                    <span class="flex items-center gap-1">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M1 2.75C1 1.784 1.784 1 2.75 1h10.5c.966 0 1.75.784 1.75 1.75v7.5A1.75 1.75 0 0 1 13.25 12H9.06l-2.573 2.573A1.458 1.458 0 0 1 4 13.543V12H2.75A1.75 1.75 0 0 1 1 10.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h4.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                        </svg>
                        {{ post.comments.count }}
                    </span>
                </div>
            </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12 bg-gray-50 rounded-lg">
            <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
            </svg>
            <p class="text-gray-600 text-lg">아직 게시글이 없습니다</p>
            <p class="text-gray-500 text-sm mt-2">첫 번째 게시글을 작성해보세요!</p>
        </div>
    {% endif %}
    </main>
</div>
{% endblock %}
