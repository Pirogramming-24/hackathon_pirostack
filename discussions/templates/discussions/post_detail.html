{% extends "base.html" %}

{% block title %}
{{ post.title }}
{% endblock %}

{% block content %}
<h1>{{ post.title }}</h1>

<p>
    작성자: {{ post.author }} |
    {{ post.created_at|date:"Y-m-d H:i" }}
</p>

<!-- 게시글 내용 -->
<hr>

<p style="white-space: pre-line;">
    {{ post.content }}
</p>

{% if post.image %}
    <div>
        <img src="{{ post.image.url }}" style="max-width: 100%;">
    </div>
{% endif %}

{% if post.link %}
    <p>
        <a href="{{ post.link }}" target="_blank">
            참고 링크
        </a>
    </p>
{% endif %}

<!-- 로그인 연동 후 -->
 {% comment %}
 로그인 연동 후 작성자만 수정/삭제 가능
{% if user.is_authenticated and post.author == user %}
    <a href="{% url 'discussions:post_edit' post.id %}">수정</a>

    <form method="post" action="{% url 'discussions:post_delete' post.id %}">
        {% csrf_token %}
        <button type="submit">삭제</button>
    </form>
{% endif %}
{% endcomment %}

<!-- 임시 -->
<a href="{% url 'discussions:post_edit' post.id %}">수정</a>
<form method="post" action="{% url 'discussions:post_delete' post.id %}">
    {% csrf_token %}
    <button type="submit">삭제</button>
</form>

<p>
    <a href="{% url 'discussions:post_list' %}">←목록으로</a>
</p>


<!-- 댓글 부분 -->
<hr>

<h3>댓글</h3>

{% for comment in comments %}
    <div style="margin-bottom: 10px;">
        <strong>{{ comment.author }}</strong>
        <small>{{ comment.created_at|date:"Y-m-d H:i" }}</small>
        <p>{{ comment.content }}</p>


        <!-- 임시 -->
        {% comment %}
        로그인 연동 후 작성자만 댓글 삭제 가능
        {% if user.is_authenticated and comment.author == user %}
        {% endcomment %}
        
        <form method="post" action="{% url 'discussions:comment_delete' comment.id %}"
              style="display:inline;">
            {% csrf_token %}
            <button type="submit">삭제</button>
        </form>

        {% comment %}
        {% endif %}
        {% endcomment %}

    </div>
{% empty %}
    <p>아직 댓글이 없습니다.</p>
{% endfor %}

<hr>

<form method="post" action="{% url 'discussions:comment_create' post.id %}">
    {% csrf_token %}
    <textarea name="content" rows="3" style="width: 100%;" required></textarea>
    <button type="submit">댓글 등록</button>
</form>

{% endblock %}
